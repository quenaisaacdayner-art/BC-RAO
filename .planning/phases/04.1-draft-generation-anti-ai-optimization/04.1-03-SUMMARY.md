---
phase: 04.1-draft-generation-anti-ai-optimization
plan: 03
subsystem: analysis
tags: [spacy, nlp, burstiness, imperfections, style-guide, community-intelligence]

# Dependency graph
requires:
  - phase: 03-pattern-engine
    provides: "SpaCy pipeline, style_extractor, style_guide_generator, scorers"
provides:
  - "Imperfection metrics (fragment_ratio, parenthetical_frequency, self_correction_rate, dash_interruption_rate) in style_extractor"
  - "Opinion landscape (loved/hated tools, controversial takes, tribal knowledge, strong biases) in style guide LLM prompt"
  - "Imperfection profile (typos, grammar looseness, self-correction, digression) in style guide LLM prompt"
  - "Burstiness score (CV-based sentence length variance) in scorers"
  - "Updated post scoring formula with burstiness weight"
affects: [04.1-01-prompt-builder, 04.1-02-blacklist-regeneration, generation-service]

# Tech tracking
tech-stack:
  added: []
  patterns: ["CV (coefficient of variation) for burstiness measurement", "SpaCy POS-based fragment detection"]

key-files:
  modified:
    - "bc-rao-api/app/analysis/style_extractor.py"
    - "bc-rao-api/app/analysis/style_guide_generator.py"
    - "bc-rao-api/app/analysis/scorers.py"
    - "bc-rao-api/tests/test_style_extractor.py"
    - "bc-rao-api/tests/test_style_guide_generator.py"

key-decisions:
  - "Burstiness weight 0.15 in scoring formula, rebalanced vulnerability 0.25->0.20, rhythm 0.25->0.20, formality 0.20->0.15"
  - "Fragment detection skips single-word sentences to reduce false positives"
  - "Parenthetical regex requires 5+ chars inside parens to filter emoticons"

patterns-established:
  - "Imperfection metrics as community fingerprint: fragment_ratio, parenthetical_frequency, self_correction_rate, dash_interruption_rate"
  - "CV-based burstiness: human text CV 0.5-0.8, AI text CV 0.2-0.4"
  - "Opinion landscape as LLM-generated community bias data"

# Metrics
duration: 6min
completed: 2026-02-12
---

# Phase 04.1 Plan 03: Community Intelligence Enrichment Summary

**SpaCy imperfection metrics (fragment/parenthetical/self-correction/dash rates), LLM opinion landscape (5 fields) and imperfection profile (4 fields), plus CV-based burstiness scoring at 0.15 weight in post score formula**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-13T02:35:12Z
- **Completed:** 2026-02-13T02:41:18Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- Style extractor now captures 4 imperfection metrics using SpaCy POS tags and regex, giving generation LLM data on how messy community writing is
- Style guide generator prompts LLM for opinion landscape (loved/hated tools, controversial takes, tribal knowledge, strong biases) and imperfection profile (typos, grammar looseness, self-correction, digression)
- Burstiness score uses coefficient of variation (std/mean) to distinguish human-like (CV 0.5-0.8, scores 6-10) from AI-like (CV 0.2-0.4, scores 0-6) sentence length variance
- All new fields use .get() with defaults for backward compatibility with existing profiles

## Task Commits

Each task was committed atomically:

1. **Task 1: Add imperfection metrics to style_extractor.py and opinion landscape to style_guide_generator.py** - `8e638d2` (feat)
2. **Task 2: Add burstiness score to scorers.py** - `1937727` (feat)

## Files Created/Modified
- `bc-rao-api/app/analysis/style_extractor.py` - Added _extract_imperfections() with fragment_ratio, parenthetical_frequency, self_correction_rate, dash_interruption_rate; updated _empty_style()
- `bc-rao-api/app/analysis/style_guide_generator.py` - Added opinion_landscape (5 list fields) and imperfection_profile (4 string fields) to EMPTY_STYLE_GUIDE, USER_PROMPT_TEMPLATE, and _validate_style_guide()
- `bc-rao-api/app/analysis/scorers.py` - Added calculate_burstiness_score() with CV formula; integrated at 0.15 weight in calculate_post_score(); added burstiness_score to return dict
- `bc-rao-api/tests/test_style_extractor.py` - Added test_imperfections_extraction and test_imperfections_in_empty_style
- `bc-rao-api/tests/test_style_guide_generator.py` - Added TestNewStyleGuideFields class with 4 tests for opinion_landscape and imperfection_profile validation

## Decisions Made
- Burstiness weight set to 0.15, requiring rebalance of existing weights: vulnerability 0.25->0.20, rhythm 0.25->0.20, formality 0.20->0.15. Penalty weights unchanged at 0.15 each.
- Fragment detection skips single-word sentences (avoids counting "ok" or "yes" as fragments)
- Parenthetical regex requires 5+ characters inside parens to filter emoticons like ":)" from being counted

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
- Pre-existing test failures in test_collection_service.py, test_cost_tracker.py, test_monitoring_service.py, and test_regex_filter.py due to a conftest.py mock bug (Mock object with no len()). These are unrelated to this plan's changes and existed before execution began.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Imperfection metrics ready for prompt_builder.py to format into generation prompts (Plan 01 or future)
- Opinion landscape and imperfection profile ready for _format_style_guide() consumption
- Burstiness score integrated into calculate_post_score() return dict, available for generation_service.py Step 7 scoring
- All new fields backward compatible - old profiles without these fields work without errors

---
*Phase: 04.1-draft-generation-anti-ai-optimization*
*Completed: 2026-02-12*
