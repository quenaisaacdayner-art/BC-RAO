---
phase: 01-foundation-core-setup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - bc-rao-frontend/package.json
  - bc-rao-frontend/app/layout.tsx
  - bc-rao-frontend/app/middleware.ts
  - bc-rao-frontend/lib/supabase/client.ts
  - bc-rao-frontend/lib/supabase/server.ts
  - bc-rao-frontend/lib/utils.ts
  - bc-rao-frontend/components/theme-provider.tsx
  - bc-rao-frontend/tailwind.config.ts
  - bc-rao-frontend/components.json
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts and renders the root page"
    - "Supabase middleware refreshes JWT tokens on every request"
    - "Dark/light mode toggle works and persists across page loads"
    - "Shadcn/UI components are available for use in subsequent plans"
  artifacts:
    - path: "bc-rao-frontend/app/layout.tsx"
      provides: "Root layout with ThemeProvider and font setup"
      min_lines: 20
    - path: "bc-rao-frontend/app/middleware.ts"
      provides: "Supabase SSR middleware for token refresh"
      contains: "createServerClient"
    - path: "bc-rao-frontend/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      exports: ["createClient"]
    - path: "bc-rao-frontend/lib/supabase/server.ts"
      provides: "Server component Supabase client"
      exports: ["createClient"]
    - path: "bc-rao-frontend/components/theme-provider.tsx"
      provides: "Dark/light mode theme provider using next-themes"
      exports: ["ThemeProvider"]
  key_links:
    - from: "bc-rao-frontend/app/layout.tsx"
      to: "bc-rao-frontend/components/theme-provider.tsx"
      via: "ThemeProvider wrapping children"
      pattern: "<ThemeProvider"
    - from: "bc-rao-frontend/app/middleware.ts"
      to: "bc-rao-frontend/lib/supabase/server.ts"
      via: "Supabase SSR client creation"
      pattern: "createServerClient"
---

<objective>
Frontend foundation: Next.js 15 scaffold with Tailwind, Shadcn/UI, Supabase SSR middleware, and dark/light mode theme provider.

Purpose: Every frontend plan depends on this scaffold existing with working Supabase auth middleware, theme support, and Shadcn/UI component library initialized.
Output: Running Next.js dev server with theme toggle, Supabase clients, and Shadcn components ready.
</objective>

<execution_context>
@C:\Users\quena\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\quena\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-core-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Next.js project with Tailwind, Shadcn/UI, and Supabase SSR</name>
  <files>
    bc-rao-frontend/package.json
    bc-rao-frontend/tailwind.config.ts
    bc-rao-frontend/components.json
    bc-rao-frontend/app/globals.css
    bc-rao-frontend/lib/utils.ts
    bc-rao-frontend/.env.example
  </files>
  <action>
1. Create Next.js 15 project:
   ```
   npx create-next-app@latest bc-rao-frontend --typescript --tailwind --app --src-dir=false --import-alias="@/*"
   ```

2. Initialize Shadcn/UI:
   ```
   cd bc-rao-frontend
   npx shadcn@latest init
   ```
   Choose: New York style, slate base color, CSS variables for colors.

3. Install required Shadcn components for Phase 1:
   ```
   npx shadcn@latest add button card input textarea form label sidebar separator tooltip avatar dropdown-menu sheet
   ```

4. Install additional dependencies:
   ```
   npm install @supabase/supabase-js @supabase/ssr next-themes lucide-react
   npm install -D @types/node
   ```

5. Create `.env.example` with:
   - NEXT_PUBLIC_SUPABASE_URL
   - NEXT_PUBLIC_SUPABASE_ANON_KEY
   - NEXT_PUBLIC_API_URL (defaults to http://localhost:8000/v1)

6. Ensure `tailwind.config.ts` includes darkMode: "class" for dark mode support (Shadcn init should handle this, verify).
  </action>
  <verify>
1. `cd bc-rao-frontend && npm run dev` starts without errors
2. `ls components/ui/` shows button.tsx, card.tsx, input.tsx, sidebar.tsx, etc.
3. `cat .env.example` shows all 3 env vars
  </verify>
  <done>Next.js project created with Tailwind, Shadcn/UI initialized, all Phase 1 UI components installed, Supabase and next-themes dependencies ready.</done>
</task>

<task type="auto">
  <name>Task 2: Supabase clients, SSR middleware, and theme provider</name>
  <files>
    bc-rao-frontend/lib/supabase/client.ts
    bc-rao-frontend/lib/supabase/server.ts
    bc-rao-frontend/app/middleware.ts
    bc-rao-frontend/components/theme-provider.tsx
    bc-rao-frontend/app/layout.tsx
    bc-rao-frontend/app/page.tsx
  </files>
  <action>
**lib/supabase/client.ts:**
- Browser-side Supabase client using `createBrowserClient` from `@supabase/ssr`
- Uses NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
- Export a `createClient` function (not a singleton - SSR safety)

**lib/supabase/server.ts:**
- Server component Supabase client using `createServerClient` from `@supabase/ssr`
- Reads/writes cookies via `cookies()` from `next/headers`
- Export a `createClient` async function
- Uses `getClaims()` pattern (NOT `getSession()`) per research findings

**app/middleware.ts (NOT inside app/ - must be at root or use middleware.ts):**
IMPORTANT: Next.js middleware must be at `middleware.ts` in the project root, NOT inside app/. Create it at `bc-rao-frontend/middleware.ts`.

- Implements Supabase SSR token refresh middleware exactly as shown in research Pattern 1
- Creates server client with cookie get/set/remove handlers on request and response
- Calls `await supabase.auth.getUser()` to refresh the token
- Matcher config excludes static files, images, favicon
- On unauthenticated requests to `/dashboard*` routes, redirect to `/login`

**components/theme-provider.tsx:**
- "use client" component wrapping `next-themes` ThemeProvider
- Props: children, defaultTheme="system", attribute="class", enableSystem, disableTransitionOnChange
- This is a standard pattern from Shadcn docs

**app/layout.tsx:**
- Root layout with:
  - Inter font from next/font/google
  - ThemeProvider wrapping children
  - `<html lang="en" suppressHydrationWarning>` (required for next-themes)
  - Metadata: title "BC-RAO", description "Social intelligence for Reddit marketing"

**app/page.tsx:**
- Simple landing/redirect page
- If user is authenticated, redirect to /dashboard
- If not, redirect to /login
- Use server-side Supabase client to check auth state
  </action>
  <verify>
1. `npm run dev` starts, visit http://localhost:3000 â€” page renders
2. Check middleware.ts is at project root (not inside app/)
3. Browser console shows no hydration errors
4. `cat lib/supabase/server.ts` contains `createServerClient`
5. `cat components/theme-provider.tsx` contains `"use client"` and `ThemeProvider`
  </verify>
  <done>Supabase browser and server clients created, middleware refreshes tokens on every request, ThemeProvider enables dark/light mode, root layout assembled with font and metadata.</done>
</task>

</tasks>

<verification>
1. `cd bc-rao-frontend && npm run build` succeeds without errors
2. Dev server starts and renders a page at http://localhost:3000
3. middleware.ts exists at project root and contains Supabase token refresh logic
4. Theme provider wraps the app in layout.tsx
5. All Shadcn components importable: `import { Button } from "@/components/ui/button"`
</verification>

<success_criteria>
- Next.js dev server runs without errors
- Supabase SSR middleware configured with token refresh
- Dark/light mode theme provider in root layout
- Shadcn/UI components (button, card, input, textarea, form, sidebar) installed and importable
- Browser and server Supabase clients properly separated
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-setup/01-02-SUMMARY.md`
</output>
